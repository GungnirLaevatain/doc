# 1 二阶段提交协议(2PC)
该提交协议分为准备阶段和提交阶段两个阶段，并且相比于普通的本地事务，其需要引入一个协调者以协调各个事务的执行
## 1.1 准备阶段
协调者要求各个参与者准备事务的提交，此时各个参与者执行本地事务，记录undo log，但并不提交事务，若执行失败，则回复协调者以触发全局的事务回退
## 1.2 提交阶段
协调者要求各个参与者提交事务，各个参与者进行commit操作以提交事务
## 1.3 问题
1. 性能问题，因为在执行事务途中，需要所有参与者同步阻塞，所以会对性能有影响
2. 可靠性问题，当协调者出现问题后，参与者将一直处于同步阻塞状态
3. 一致性问题，提交阶段中，协调者出现问题后，若有参与者commit失败，则无法进行回退从而导致数据的不一致
# 2 三阶段提交协议(3PC)
该提交协议在2PC协议的基础上，将准备阶段和提交阶段中的前者分为可提交阶段(canCommit)和准备提交阶段(preCommit)
## 2.1 canCommit 可提交阶段
此阶段协调者向所有参与者询问当前是否可以执行事务，若均可则进行下个阶段，反之则停止事务执行
## 2.2 preCommit 准备阶段
此阶段协调者要求所有参与者准备事务的提交，各个参与者受到请求后，进行本地事务的执行，记录undo log，但是不commit
## 2.3 commit阶段
协调者要求所有参与者进行commit操作，若commit失败，则利用undo log进行回退
# 3 补偿事务(TCC)
该提交协议基于2PC上增加了补偿阶段，总共存在Try、Confirm、Cancel三个操作
## 3.1 Try阶段
该阶段主要是进行事务的准备工作
## 3.2 Confirm阶段
该阶段主要是进行事务的最终提交，此阶段应该要保证幂等性
## 3.3 Cancel阶段
当Try或者Confirm阶段异常触发全局事务回退时，参与者自定义实现的用于回退的操作，以保证数据的一致性，此阶段应该要保证幂等性
## 3.4 特点
1. 相较于2PC，具体业务来实现控制资源锁的粒度变小，不会锁定整个资源，从而提高性能
2. 基于Confirm和Cancel操作的幂等性，保证事务最终完成确认或者回退，从而保证数据的一致性。
# 4 基于MQ的事务
该协议主要是基于最终一致性
## 4.1 流程
1. 向MQ发送事务消息
2. MQ回复确认接收消息成功后，进行本地事务的执行
3. 若本地事务执行成功后，通知MQ进行事务消息的发送，若失败则通知MQ取消事务消息的发送
4. 消息接受者接收消息后，进行本地事务处理
